services:
  zigbee2mqtt:
    container_name: zigbee2mqtt
    image: koenkk/zigbee2mqtt
    restart: unless-stopped
    volumes:
      - /volume1/docker/zigbee2mqtt:/app/data
    ports:
      - 8888:8080
    environment:
      - TZ=Europe/Kiev
    privileged: true
    networks:
      macvlan1:
        ipv4_address: ${Z2MQTT_MACVLAN_IP}
      containers_bridge:
    depends_on:
       - mosquitto
    labels:            
      # homepage integration
      - homepage.group=Smart home
      - homepage.name=Zigbee2MQTT
      - homepage.icon=zigbee2mqtt.png
      - homepage.href=https://z2mqtt.${LOCAL_DOMAIN}
      - homepage.description=Zigbee to MQTT
      # auto update docker        
      - "com.centurylinklabs.watchtower.monitor-only=true"

  mosquitto:
    image: eclipse-mosquitto:1.6
    hostname: mosquitto
    container_name: mosquitto
    restart: unless-stopped
    ports:
      - 1883:1883
      - 9001:9001
    privileged: true
    networks:
      macvlan1:
        ipv4_address: ${MOSQUITTO_MACVLAN_IP}
      containers_bridge:       
    volumes:
      - /volume1/docker/mosquitto:/etc/mosquitto
    labels:            
      # auto update docker        
      - "com.centurylinklabs.watchtower.monitor-only=true"

networks:
  containers_bridge:
    external: true
  macvlan1:
    name: macvlan1
    driver: macvlan
    external: true
    driver_opts:
      parent: ovs_bond0
    ipam:
      config:
        - subnet: 192.168.1.1/24
          ip_range: 192.168.1.10/31
          gateway: 192.168.1.1